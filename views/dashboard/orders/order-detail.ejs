<!-- Trang chi tiết đơn hàng -->
<div class="order-detail-page">
  <div class="container">
    <div class="order-card">
      <div class="order-header">
        <h2>Mã đơn hàng: ORD-<%= orderId %>
        </h2>
        <div class="order-date">Ngày đặt đơn: 26/01/2025 lúc 08:50</div>
        <div class="order-status">
          <div class="status-item">
            <div class="status-label">Trạng thái thanh toán:</div>
            <div class="status-value <%= order.payment_status ? order.payment_status.toLowerCase() : 'pending' %>">
              <%= mapPaymentStatus(order.payment_status) %>
            </div>
          </div>
          <div class="status-item">
            <div class="status-label">Trạng thái đơn hàng:</div>
            <div class="status-value <%= order.current_status ? order.current_status.toLowerCase() : 'pending' %>">
              <%= mapStatus(order.current_status) %>
            </div>
          </div>
          <div class="status-item">
            <div class="status-label">Trạng thái vận chuyển:</div>
            <div class="status-value">
              <span class="badge <%= mapShippingStatusClass(order.shipping_status) %>">
                <i class="fas <%= mapShippingStatusIcon(order.shipping_status) %> mr-1"></i>
                <%= mapShippingStatus(order.shipping_status) %>
              </span>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <h3 class="section-title">Sản phẩm</h3>

        <div class="col-md-8">
          <div class="product-section">
            <div class="product-item">
              <div class="product-image">
                <img src="/images/products/wardrobe.png" alt="Sofa Modena">
              </div>
              <div class="product-details">
                <div class="product-name">Sofa Modena 2,5 seater</div>
                <div class="product-type">Sofa</div>
                <div class="price-row">
                  <div class="price-label">Thành tiền:</div>
                  <div class="price-value">15.190.000đ</div>
                </div>
                <div class="wrapper">
                  <div class="price-row">
                    <div class="price-label">Màu</div>
                    <div class="price-value">
                      <span class="color-dot"></span>
                    </div>
                  </div>
                  <div class="price-row">
                    <div class="price-label">Số lượng:</div>
                    <div class="price-value">1</div>
                  </div>
                </div>
                <div class="price-row">
                  <a href="#" class="price-label">Xem chi tiết</a>
                </div>
              </div>
            </div>

            <div class="product-item">
              <div class="product-image">
                <img src="/images/products/sofa.png" alt="Sofa Modena">
              </div>
              <div class="product-details">
                <div class="product-name">Sofa Modena 2,5 seater</div>
                <div class="product-type">Bàn</div>
                <div class="price-row">
                  <div class="price-label">Thành tiền:</div>
                  <div class="price-value">15.190.000đ</div>
                </div>
                <div class="wrapper">
                  <div class="price-row">
                    <div class="price-label">Màu</div>
                    <div class="price-value">
                      <span class="color-dot"></span>
                    </div>
                  </div>
                  <div class="price-row">
                    <div class="price-label">Số lượng:</div>
                    <div class="price-value">1</div>
                  </div>
                </div>
                <div class="price-row">
                  <a href="#" class="price-label">Xem chi tiết</a>
                </div>
              </div>
            </div>

            <div class="product-item">
              <div class="product-image">
                <img src="/images/products/table.png" alt="Sofa Modena">
              </div>
              <div class="product-details">
                <div class="product-name">Sofa Modena 2,5 seater</div>
                <div class="product-type">Tủ</div>
                <div class="price-row">
                  <div class="price-label">Thành tiền:</div>
                  <div class="price-value">15.190.000đ</div>
                </div>
                <div class="wrapper">
                  <div class="price-row">
                    <div class="price-label">Màu</div>
                    <div class="price-value">
                      <span class="color-dot"></span>
                    </div>
                  </div>
                  <div class="price-row">
                    <div class="price-label">Số lượng:</div>
                    <div class="price-value">1</div>
                  </div>
                </div>
                <div class="price-row">
                  <a href="#" class="price-label">Xem chi tiết</a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-3">
          <div class="customer-info">
            <h3 class="section-title">Thông tin khách hàng</h3>

            <div class="info-row">
              <div class="info-label">Tên khách hàng</div>
              <div class="info-value">Nguyễn Văn A</div>
            </div>

            <div class="info-row">
              <div class="info-label">Số điện thoại</div>
              <div class="info-value">084444000</div>
            </div>

            <div class="info-row">
              <div class="info-label">Email</div>
              <div class="info-value">a.nguyen@gmail.com</div>
            </div>

            <div class="info-row">
              <div class="info-label">Địa chỉ giao hàng</div>
              <div class="info-value">50 D. Hồ Tùng Mậu, Bến Nghé, Quận 1, Hồ Chí Minh</div>
            </div>

            <div class="info-row">
              <div class="info-label">Phương thức thanh toán</div>
              <div class="info-value">Thanh toán khi nhận hàng</div>
            </div>

            <div class="info-row">
              <div class="info-label">Ghi chú</div>
              <textarea class="info-value" readonly>Giao nhanh dùm</textarea>
            </div>
          </div>

          <div class="order-summary">
            <h3 class="section-title">Tóm tắt đơn hàng</h3>

            <div class="summary-row">
              <div class="summary-label">Thành tiền</div>
              <div class="summary-value">500.000</div>
            </div>

            <div class="summary-row">
              <div class="summary-label">Vận chuyển</div>
              <div class="summary-value">30.000</div>
            </div>

            <div class="summary-row">
              <div class="summary-label">Giảm giá</div>
              <div class="summary-value discount">-10%</div>
            </div>

            <div class="summary-row">
              <div class="summary-label">Mã giảm giá</div>
              <div class="summary-value">NEW10</div>
            </div>

            <div class="summary-row">
              <div class="summary-label">Tổng cộng</div>
              <div class="summary-value">500.000</div>
            </div>
          </div>

          <div class="action-buttons">
            <button class="btn btn-cancel">Hủy</button>
            <button class="btn btn-save">Lưu</button>
            <a href="/dashboard/orders/invoice/<%= orderId %>" target="_blank" class="btn btn-save" style="background-color: #4CAF50; margin-left: 10px;">Xem hóa đơn</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function mapPaymentStatus(status) {
    switch (status) {
      case 'PENDING': return 'Chờ thanh toán';
      case 'PROCESSING': return 'Đang xử lý';
      case 'SUCCESS': return 'Đã thanh toán';
      case 'FAILED': return 'Thanh toán thất bại';
      case 'CANCELLED': return 'Đã hủy';
      default: return status || 'Chờ thanh toán';
    }
  }

  function mapStatus(status) {
    switch (status) {
      case 'PENDING': return 'Chờ xác nhận';
      case 'CONFIRMED': return 'Đã xác nhận';
      case 'SHIPPING': return 'Đang giao';
      case 'SUCCESS': return 'Giao hàng thành công';
      case 'FAILED': return 'Thất bại';
      case 'CANCELLED': return 'Đã hủy';
      default: return status || 'Chờ xác nhận';
    }
  }

  function mapShippingStatus(status) {
    switch (status) {
      case 'pending': return 'Chờ lấy hàng';
      case 'picking_up': return 'Đang đi lấy hàng';
      case 'picked_up': return 'Đã lấy hàng';
      case 'in_transit': return 'Đang vận chuyển';
      case 'delivered': return 'Đã giao hàng';
      case 'delivery_failed': return 'Giao hàng thất bại';
      case 'returning': return 'Đang hoàn trả';
      case 'returned': return 'Đã hoàn trả';
      case 'canceled': return 'Đã hủy';
      default: return status || 'Chờ lấy hàng';
    }
  }

  function mapShippingStatusClass(status) {
    switch (status) {
      case 'pending': return 'badge-secondary';
      case 'picking_up': return 'badge-info';
      case 'picked_up': return 'badge-primary';
      case 'in_transit': return 'badge-primary';
      case 'delivered': return 'badge-success';
      case 'delivery_failed': return 'badge-danger';
      case 'returning': return 'badge-warning';
      case 'returned': return 'badge-warning';
      case 'canceled': return 'badge-dark';
      default: return 'badge-secondary';
    }
  }

  function mapShippingStatusIcon(status) {
    switch (status) {
      case 'pending': return 'fa-clock';
      case 'picking_up': return 'fa-people-carry';
      case 'picked_up': return 'fa-box';
      case 'in_transit': return 'fa-truck';
      case 'delivered': return 'fa-check-circle';
      case 'delivery_failed': return 'fa-times-circle';
      case 'returning': return 'fa-undo';
      case 'returned': return 'fa-box-open';
      case 'canceled': return 'fa-ban';
      default: return 'fa-clock';
    }
  }

  document.addEventListener('DOMContentLoaded', function () {
    // Xử lý sự kiện khi click vào dropdown trạng thái
    const statusDropdown = document.querySelector('.dropdown-toggle');
    if (statusDropdown) {
      statusDropdown.addEventListener('click', function () {
        // Hiển thị dropdown menu với các trạng thái đơn hàng
        console.log('Status dropdown clicked');
        // Đây là nơi để thêm code hiển thị dropdown menu
      });
    }

    // Xử lý sự kiện khi click vào nút Hủy
    const cancelButton = document.querySelector('.btn-cancel');
    if (cancelButton) {
      cancelButton.addEventListener('click', function () {
        // Quay lại trang danh sách đơn hàng
        window.location.href = '/dashboard/orders';
      });
    }

    // Xử lý sự kiện khi click vào nút Lưu
    const saveButton = document.querySelector('.btn-save');
    if (saveButton) {
      saveButton.addEventListener('click', function () {
        // Lưu thay đổi và quay lại trang danh sách đơn hàng
        console.log('Save changes');
        // Đây là nơi để thêm code lưu thay đổi
        // Sau khi lưu thành công, chuyển hướng về trang danh sách đơn hàng
        // window.location.href = '/dashboard/orders';
      });
    }
  });
</script>

<style>
  @media print {

    .sidebar,
    .dashboard-header,
    .breadcrumb,
    #update-status-btn,
    #print-order-btn {
      display: none !important;
    }

    .content-wrapper {
      margin-left: 0 !important;
      padding: 0 !important;
    }

    .card {
      box-shadow: none !important;
      border: 1px solid #ddd !important;
    }
  }
  
  /* Styles cho shipping status badge trong trang chi tiết đơn hàng */
  .order-status .badge {
    padding: 6px 12px;
    font-size: 13px;
    border-radius: 4px;
    display: inline-flex;
    align-items: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .order-status .badge i {
    margin-right: 6px;
    font-size: 14px;
  }
  
  /* Hiệu ứng hover cho badge trong trang chi tiết */
  .order-status .badge:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    transition: all 0.3s ease;
  }
  
  /* Màu sắc đậm hơn cho badge trong trang chi tiết */
  .order-status .badge-secondary { background-color: #5a6268; }
  .order-status .badge-info { background-color: #138496; }
  .order-status .badge-primary { background-color: #0069d9; }
  .order-status .badge-success { background-color: #218838; }
  .order-status .badge-danger { background-color: #c82333; }
  .order-status .badge-warning { background-color: #e0a800; }
  .order-status .badge-dark { background-color: #23272b; }
</style>