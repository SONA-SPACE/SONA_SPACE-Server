<link rel="stylesheet" href="/scss/style.css">
<!-- Th√™m jQuery v√† Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Th√™m Ant Design -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/antd@4.24.15/dist/antd.min.css">
<script src="https://cdn.jsdelivr.net/npm/antd@4.24.15/dist/antd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>

<!-- Trang qu·∫£n l√Ω ƒë∆°n h√†ng -->
<div class="orders-page">
  <div class="content-wrapper">
    <div class="content-header">
      <div class="container-fluid">
        <div class="page-header">
          <h1>ƒê∆°n h√†ng</h1>
          <div class="actions">
            <button class="btn btn-primary">
              <i class="fas fa-plus"></i> Th√™m ƒë∆°n h√†ng m·ªõi
            </button>
          </div>
        </div>

        <div class="search-bar">
          <div class="search-input">
            <i class="fas fa-search search-icon"></i>
            <input type="text" placeholder="T√¨m ki·∫øm ƒë∆°n h√†ng..." id="search-orders">
          </div>

          <div class="date-range">
            <i class="far fa-calendar-alt calendar-icon"></i>
            <span>1/05/2025 - 31/5/2025</span>
          </div>

          <div class="filter-btn">
            <span>Hi·ªÉn th·ªã 6 tr√™n t·ªïng s·ªë 500</span>
          </div>
        </div>

        <div class="orders-summary">
          <div class="summary-card">
            <div class="card-title">T·ªïng ƒë∆°n h√†ng</div>
            <div class="card-value">20</div>
          </div>

          <div class="summary-card">
            <div class="card-title">ƒê∆°n h√†ng</div>
            <div class="card-subtitle">ƒê∆°n h√†ng ƒëang ch·ªù x·ª≠ l√Ω</div>
            <div class="card-value">20</div>
          </div>

          <div class="summary-card">
            <div class="card-title">ƒêang v·∫≠n chuy·ªÉn</div>
            <div class="card-subtitle">T·ªïng ƒë∆°n h√†ng ƒëang v·∫≠n chuy·ªÉn</div>
            <div class="card-value">2</div>
          </div>

          <div class="summary-card">
            <div class="card-title">Ho√†n tr·∫£ ƒë∆°n h√†ng</div>
            <div class="card-subtitle">ƒê∆°n h√†ng ƒë∆∞·ª£c y√™u c·∫ßu tr·∫£ h√†ng</div>
            <div class="card-value">0</div>
          </div>

          <div class="summary-card">
            <div class="card-title">H·ªßy ƒë∆°n h√†ng</div>
            <div class="card-subtitle">ƒê∆°n h√†ng ƒë∆∞·ª£c y√™u c·∫ßu h·ªßy</div>
            <div class="card-value">0</div>
          </div>
        </div>

        <div class="orders-table">
          <div class="table-header">
            <div class="bulk-actions">
              <input type="checkbox" class="checkbox">
              <div class="dropdown">
                <button class="dropdown-toggle">M√£ ƒë∆°n <i class="fas fa-chevron-down"></i></button>
                <div class="dropdown-menu">
                  <a class="dropdown-item" href="#" data-sort="asc">TƒÉng d·∫ßn (A-Z)</a>
                  <a class="dropdown-item" href="#" data-sort="desc">Gi·∫£m d·∫ßn (Z-A)</a>
                </div>
              </div>
            </div>

            <div class="table-filters">
              <div class="filter">
                <button class="filter-toggle">Ng√†y ƒë·∫∑t ƒë∆°n</button>
                <div class="filter-dropdown">
                  <a class="filter-item" href="#" data-sort="date-asc">C≈© nh·∫•t tr∆∞·ªõc</a>
                  <a class="filter-item" href="#" data-sort="date-desc">M·ªõi nh·∫•t tr∆∞·ªõc</a>
                </div>
              </div>
              <div class="filter">
                <button class="filter-toggle">Kh√°ch h√†ng</button>
                <div class="filter-dropdown">
                  <a class="filter-item" href="#" data-sort="customer-asc">T√™n (A-Z)</a>
                  <a class="filter-item" href="#" data-sort="customer-desc">T√™n (Z-A)</a>
                </div>
              </div>
              <div class="filter">
                <button class="filter-toggle">Thanh to√°n</button>
                <div class="filter-dropdown">
                  <a class="filter-item" href="#" data-sort="payment-paid">ƒê√£ thanh to√°n</a>
                  <a class="filter-item" href="#" data-sort="payment-unpaid">Ch∆∞a thanh to√°n</a>
                  <a class="filter-item" href="#" data-sort="payment-all">T·∫•t c·∫£</a>
                </div>
              </div>
              <div class="filter">
                <button class="filter-toggle">S·∫£n ph·∫©m</button>
                <div class="filter-dropdown">
                  <a class="filter-item" href="#" data-sort="products-asc">S·ªë l∆∞·ª£ng tƒÉng d·∫ßn</a>
                  <a class="filter-item" href="#" data-sort="products-desc">S·ªë l∆∞·ª£ng gi·∫£m d·∫ßn</a>
                </div>
              </div>
              <div class="filter">
                <button class="filter-toggle">T·ªïng ti·ªÅn</button>
                <div class="filter-dropdown">
                  <a class="filter-item" href="#" data-sort="total-asc">Gi√° tr·ªã tƒÉng d·∫ßn</a>
                  <a class="filter-item" href="#" data-sort="total-desc">Gi√° tr·ªã gi·∫£m d·∫ßn</a>
                </div>
              </div>
              <div class="filter">
                <button class="filter-toggle">V·∫≠n chuy·ªÉn</button>
                <div class="filter-dropdown">
                  <a class="filter-item" href="#" data-sort="shipping-pending">Ch·ªù l·∫•y h√†ng</a>
                  <a class="filter-item" href="#" data-sort="shipping-transit">ƒêang v·∫≠n chuy·ªÉn</a>
                  <a class="filter-item" href="#" data-sort="shipping-delivered">ƒê√£ giao h√†ng</a>
                  <a class="filter-item" href="#" data-sort="shipping-failed">Giao h√†ng th·∫•t b·∫°i</a>
                  <a class="filter-item" href="#" data-sort="shipping-returned">ƒê√£ ho√†n tr·∫£</a>
                  <a class="filter-item" href="#" data-sort="shipping-all">T·∫•t c·∫£</a>
                </div>
              </div>
              <div class="filter">
                <button class="filter-toggle">Tr·∫°ng th√°i</button>
                <div class="filter-dropdown">
                  <a class="filter-item" href="#" data-sort="status-pending">Ch·ªù x√°c nh·∫≠n</a>
                  <a class="filter-item" href="#" data-sort="status-confirmed">ƒê√£ x√°c nh·∫≠n</a>
                  <a class="filter-item" href="#" data-sort="status-shipping">ƒêang giao</a>
                  <a class="filter-item" href="#" data-sort="status-success">Giao h√†ng th√†nh c√¥ng</a>
                  <a class="filter-item" href="#" data-sort="status-failed">Th·∫•t b·∫°i</a>
                  <a class="filter-item" href="#" data-sort="status-cancelled">ƒê√£ h·ªßy</a>
                  <a class="filter-item" href="#" data-sort="status-all">T·∫•t c·∫£</a>
                </div>
              </div>
              <div class="filter">
                <button class="filter-toggle">Ng√†y c·∫≠p nh·∫≠t</button>
                <div class="filter-dropdown">
                  <a class="filter-item" href="#" data-sort="update-asc">C≈© nh·∫•t tr∆∞·ªõc</a>
                  <a class="filter-item" href="#" data-sort="update-desc">M·ªõi nh·∫•t tr∆∞·ªõc</a>
                </div>
              </div>
              <div class="filter">
                <button class="filter-toggle">H√†nh ƒë·ªông</button>
                <div class="filter-dropdown">
                  <a class="filter-item" href="#" data-action="export">Xu·∫•t Excel</a>
                  <a class="filter-item" href="#" data-action="print">In danh s√°ch</a>
                </div>
              </div>
            </div>
          </div>

          <table>
            <tbody id="orders-list">
              <!-- D·ªØ li·ªáu ƒë∆°n h√†ng m·∫´u -->
              <!-- <tr>
                <td><input type="checkbox" class="checkbox"></td>
                <td class="order-id">ORD-10586</td>
                <td>16:08:55 8-05-2025</td>
                <td>Nguy·ªÖn X</td>
                <td><span class="status paid">ƒê√£ thanh to√°n</span></td>
                <td>2 s·∫£n ph·∫©m</td>
                <td>15.050.000 ƒë</td>
                <td>-</td>
                <td><span class="status processing">Y√™u c·∫ßu h·ªßy</span></td>
                <td>16:08:55 8-05-2025</td>
                <td>
                  <div class="actions">
                    <button class="action-btn"><i class="fas fa-pencil-alt"></i></button>
                    <button class="action-btn"><i class="fas fa-trash-alt"></i></button>
                  </div>
                </td>
              </tr>
              
              <tr>
                <td><input type="checkbox" class="checkbox"></td>
                <td class="order-id">ORD-10586</td>
                <td>16:08:55 8-05-2025</td>
                <td>Nguy·ªÖn X</td>
                <td><span class="status paid">ƒê√£ thanh to√°n</span></td>
                <td>2 s·∫£n ph·∫©m</td>
                <td>15.050.000 ƒë</td>
                <td>-</td>
                <td><span class="status processing">Ch·ªù x√°c nh·∫≠n</span></td>
                <td>16:08:55 8-05-2025</td>
                <td>
                  <div class="actions">
                    <button class="action-btn"><i class="fas fa-pencil-alt"></i></button>
                    <button class="action-btn"><i class="fas fa-trash-alt"></i></button>
                  </div>
                </td>
              </tr>
              
              <tr>
                <td><input type="checkbox" class="checkbox"></td>
                <td class="order-id">ORD-10586</td>
                <td>16:08:55 8-05-2025</td>
                <td>Nguy·ªÖn X</td>
                <td><span class="status paid">ƒê√£ thanh to√°n</span></td>
                <td>2 s·∫£n ph·∫©m</td>
                <td>15.050.000 ƒë</td>
                <td>-</td>
                <td><span class="status processing">Y√™u c·∫ßu h·ªßy</span></td>
                <td>16:08:55 8-05-2025</td>
                <td>
                  <div class="actions">
                    <button class="action-btn"><i class="fas fa-pencil-alt"></i></button>
                    <button class="action-btn"><i class="fas fa-trash-alt"></i></button>
                  </div>
                </td>
              </tr>
              
              <tr>
                <td><input type="checkbox" class="checkbox"></td>
                <td class="order-id">ORD-10586</td>
                <td>16:08:55 8-05-2025</td>
                <td>Nguy·ªÖn X</td>
                <td><span class="status paid">ƒê√£ thanh to√°n</span></td>
                <td>2 s·∫£n ph·∫©m</td>
                <td>15.050.000 ƒë</td>
                <td>-</td>
                <td><span class="status delivered">ƒê√£ h·ªßy</span></td>
                <td>16:08:55 8-05-2025</td>
                <td>
                  <div class="actions">
                    <button class="action-btn"><i class="fas fa-pencil-alt"></i></button>
                    <button class="action-btn"><i class="fas fa-trash-alt"></i></button>
                  </div>
                </td>
              </tr>
              
              <tr>
                <td><input type="checkbox" class="checkbox"></td>
                <td class="order-id">ORD-10586</td>
                <td>16:08:55 8-05-2025</td>
                <td>Nguy·ªÖn X</td>
                <td><span class="status paid">ƒê√£ thanh to√°n</span></td>
                <td>2 s·∫£n ph·∫©m</td>
                <td>15.050.000 ƒë</td>
                <td>-</td>
                <td><span class="status shipped">ƒêang giao</span></td>
                <td>16:08:55 8-05-2025</td>
                <td>
                  <div class="actions">
                    <button class="action-btn"><i class="fas fa-pencil-alt"></i></button>
                    <button class="action-btn"><i class="fas fa-trash-alt"></i></button>
                  </div>
                </td>
              </tr>
              
              <tr>
                <td><input type="checkbox" class="checkbox"></td>
                <td class="order-id">ORD-10586</td>
                <td>16:08:55 8-05-2025</td>
                <td>Nguy·ªÖn X</td>
                <td><span class="status paid">ƒê√£ thanh to√°n</span></td>
                <td>2 s·∫£n ph·∫©m</td>
                <td>15.050.000 ƒë</td>
                <td>-</td>
                <td><span class="status processing">Y√™u c·∫ßu tr·∫£ h√†ng</span></td>
                <td>16:08:55 8-05-2025</td>
                <td>
                  <div class="actions">
                    <button class="action-btn"><i class="fas fa-pencil-alt"></i></button>
                    <button class="action-btn"><i class="fas fa-trash-alt"></i></button>
                  </div>
                </td>
              </tr>
              
              <tr>
                <td><input type="checkbox" class="checkbox"></td>
                <td class="order-id">ORD-10586</td>
                <td>16:08:55 8-05-2025</td>
                <td>Nguy·ªÖn X</td>
                <td><span class="status paid">ƒê√£ thanh to√°n</span></td>
                <td>2 s·∫£n ph·∫©m</td>
                <td>15.050.000 ƒë</td>
                <td>-</td>
                <td><span class="status delivered">Tr·∫£ h√†ng</span></td>
                <td>16:08:55 8-05-2025</td>
                <td>
                  <div class="actions">
                    <button class="action-btn"><i class="fas fa-pencil-alt"></i></button>
                    <button class="action-btn"><i class="fas fa-trash-alt"></i></button>
                  </div>
                </td>
              </tr>
              
              <tr>
                <td><input type="checkbox" class="checkbox"></td>
                <td class="order-id">ORD-10586</td>
                <td>16:08:55 8-05-2025</td>
                <td>Nguy·ªÖn X</td>
                <td><span class="status paid">ƒê√£ thanh to√°n</span></td>
                <td>2 s·∫£n ph·∫©m</td>
                <td>15.050.000 ƒë</td>
                <td>-</td>
                <td><span class="status delivered">Giao h√†ng th√†nh c√¥ng</span></td>
                <td>16:08:55 8-05-2025</td>
                <td>
                  <div class="actions">
                    <button class="action-btn"><i class="fas fa-pencil-alt"></i></button>
                    <button class="action-btn"><i class="fas fa-trash-alt"></i></button>
                  </div>
                </td>
              </tr> -->
            </tbody>
          </table>

          <div class="table-footer">
            <div class="showing-info">Hi·ªÉn th·ªã 1-8 tr√™n t·ªïng s·ªë 20 ƒë∆°n h√†ng</div>
            <div class="pagination">
              <button class="page-item disabled"><i class="fas fa-chevron-left"></i></button>
              <button class="page-item active">1</button>
              <button class="page-item">2</button>
              <button class="page-item">3</button>
              <button class="page-item"><i class="fas fa-chevron-right"></i></button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal xem chi ti·∫øt ƒë∆°n h√†ng -->
<div class="modal fade" id="order-detail-modal" tabindex="-1" role="dialog" aria-labelledby="orderDetailModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="orderDetailModalLabel">Chi ti·∫øt ƒë∆°n h√†ng #<span id="order-id"></span></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="order-detail-content">
        <!-- Chi ti·∫øt ƒë∆°n h√†ng s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y b·∫±ng JavaScript -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">ƒê√≥ng</button>
        <button type="button" class="btn btn-primary" id="update-status-btn">C·∫≠p nh·∫≠t tr·∫°ng th√°i</button>
      </div>
    </div>
  </div>
</div>

<!-- X√≥a modal thay ƒë·ªïi tr·∫°ng th√°i ƒë∆°n h√†ng v√¨ ƒë√£ kh√¥ng c·∫ßn thi·∫øt n·ªØa -->

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // X·ª≠ l√Ω s·ª± ki·ªán ch·ªçn t·∫•t c·∫£ checkbox
    const selectAllCheckbox = document.querySelector('.table-header .checkbox');
    const rowCheckboxes = document.querySelectorAll('tbody .checkbox');

    if (selectAllCheckbox) {
      selectAllCheckbox.addEventListener('change', function () {
        const isChecked = this.checked;
        rowCheckboxes.forEach(checkbox => {
          checkbox.checked = isChecked;
        });
      });
    }

    // X·ª≠ l√Ω s·ª± ki·ªán khi click v√†o dropdown filters
    const filterToggles = document.querySelectorAll('.filter-toggle');

    filterToggles.forEach(toggle => {
      toggle.addEventListener('click', function (e) {
        e.preventDefault(); // NgƒÉn h√†nh vi m·∫∑c ƒë·ªãnh
        e.stopPropagation(); // NgƒÉn s·ª± ki·ªán lan ra ngo√†i
        
        const dropdown = this.nextElementSibling;
        
        // ƒê√≥ng t·∫•t c·∫£ c√°c dropdown kh√°c
        document.querySelectorAll('.filter-dropdown, .dropdown-menu').forEach(item => {
          if (item !== dropdown) {
            item.classList.remove('active');
          }
        });
        
        // Toggle dropdown hi·ªán t·∫°i
        dropdown.classList.toggle('active');
      });
      
      // NgƒÉn s·ª± ki·ªán mouseenter v√† mouseleave ƒë·ªÉ tr√°nh xung ƒë·ªôt v·ªõi hover CSS
      toggle.parentElement.addEventListener('mouseenter', function(e) {
        e.stopPropagation();
      });
      
      toggle.parentElement.addEventListener('mouseleave', function(e) {
        e.stopPropagation();
      });
    });
    
    // X·ª≠ l√Ω s·ª± ki·ªán khi click v√†o c√°c item trong dropdown
    document.querySelectorAll('.filter-item').forEach(item => {
      item.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const sortType = this.getAttribute('data-sort');
        console.log('Sorting by:', sortType);
        
        // Hi·ªÉn th·ªã th√¥ng b√°o ƒëang s·∫Øp x·∫øp
        if (window.antd && window.antd.message) {
          window.antd.message.loading('ƒêang s·∫Øp x·∫øp d·ªØ li·ªáu...');
        }
        
        // Th·ª±c hi·ªán s·∫Øp x·∫øp d·ªØ li·ªáu
        sortOrders(sortType);
        
        // ƒê√≥ng dropdown sau khi ch·ªçn
        this.closest('.filter-dropdown').classList.remove('active');
      });
    });
    
    // X·ª≠ l√Ω s·ª± ki·ªán khi click v√†o dropdown trong bulk actions
    const dropdownToggle = document.querySelector('.dropdown-toggle');
    if (dropdownToggle) {
      dropdownToggle.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const menu = this.nextElementSibling;
        
        // ƒê√≥ng t·∫•t c·∫£ c√°c dropdown kh√°c
        document.querySelectorAll('.filter-dropdown, .dropdown-menu').forEach(item => {
          if (item !== menu) {
            item.classList.remove('active');
          }
        });
        
        // Toggle dropdown hi·ªán t·∫°i
        menu.classList.toggle('active');
      });
      
      // NgƒÉn s·ª± ki·ªán mouseenter v√† mouseleave ƒë·ªÉ tr√°nh xung ƒë·ªôt v·ªõi hover CSS
      dropdownToggle.parentElement.addEventListener('mouseenter', function(e) {
        e.stopPropagation();
      });
      
      dropdownToggle.parentElement.addEventListener('mouseleave', function(e) {
        e.stopPropagation();
      });
    }
    
    // X·ª≠ l√Ω s·ª± ki·ªán khi click v√†o c√°c item trong dropdown bulk actions
    document.querySelectorAll('.dropdown-item').forEach(item => {
      item.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const sortType = this.getAttribute('data-sort');
        console.log('Sorting order IDs by:', sortType);
        
        // Hi·ªÉn th·ªã th√¥ng b√°o ƒëang s·∫Øp x·∫øp
        if (window.antd && window.antd.message) {
          window.antd.message.loading('ƒêang s·∫Øp x·∫øp d·ªØ li·ªáu...');
        }
        
        // Th·ª±c hi·ªán s·∫Øp x·∫øp d·ªØ li·ªáu theo m√£ ƒë∆°n
        sortOrders('order-' + sortType);
        
        // ƒê√≥ng dropdown sau khi ch·ªçn
        this.closest('.dropdown-menu').classList.remove('active');
      });
    });
    
    // NgƒÉn s·ª± ki·ªán hover tr√™n c√°c dropdown
    document.querySelectorAll('.filter-dropdown, .dropdown-menu').forEach(dropdown => {
      dropdown.addEventListener('mouseenter', function(e) {
        e.stopPropagation();
        // N·∫øu dropdown ƒëang active, gi·ªØ n√≥ active
        if (this.classList.contains('active')) {
          e.preventDefault();
        }
      });
      
      dropdown.addEventListener('mouseleave', function(e) {
        e.stopPropagation();
        // Kh√¥ng ƒë√≥ng dropdown khi di chuy·ªÉn chu·ªôt ra ngo√†i
      });
    });
    
    // ƒê√≥ng t·∫•t c·∫£ dropdown khi click ra ngo√†i
    document.addEventListener('click', function(e) {
      // Ki·ªÉm tra xem click c√≥ ph·∫£i l√† tr√™n dropdown hay kh√¥ng
      const isClickInsideDropdown = e.target.closest('.filter-dropdown') || e.target.closest('.dropdown-menu');
      const isClickOnToggle = e.target.closest('.filter-toggle') || e.target.closest('.dropdown-toggle');
      
      if (!isClickInsideDropdown && !isClickOnToggle) {
        document.querySelectorAll('.filter-dropdown, .dropdown-menu').forEach(dropdown => {
          dropdown.classList.remove('active');
        });
      }
    });

    // X·ª≠ l√Ω s·ª± ki·ªán khi click v√†o n√∫t ch·ªânh s·ª≠a
    const editButtons = document.querySelectorAll('.action-btn.edit');

    editButtons.forEach(button => {
      button.addEventListener('click', function () {
        const row = this.closest('tr');
        const orderId = row.querySelector('.order-id').textContent;
        console.log('Edit order:', orderId);
        // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang ch·ªânh s·ª≠a ƒë∆°n h√†ng
        // window.location.href = `/dashboard/orders/edit/${orderId}`;
      });
    });

    // X·ª≠ l√Ω s·ª± ki·ªán khi click v√†o n√∫t x√≥a
    const deleteButtons = document.querySelectorAll('.action-btn.delete');

    deleteButtons.forEach(button => {
      button.addEventListener('click', function () {
        const row = this.closest('tr');
        const orderId = row.querySelector('.order-id').textContent;

        if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ƒë∆°n h√†ng ${orderId}?`)) {
          console.log('Delete order:', orderId);
          // G·ªçi API x√≥a ƒë∆°n h√†ng
          // fetch(`/api/orders/${orderId}`, { method: 'DELETE' })
          //   .then(response => response.json())
          //   .then(data => {
          //     if (data.success) {
          //       row.remove();
          //     }
          //   });
        }
      });
    });

    // X·ª≠ l√Ω s·ª± ki·ªán t√¨m ki·∫øm
    const searchInput = document.getElementById('search-orders');

    if (searchInput) {
      searchInput.addEventListener('keyup', function (e) {
        if (e.key === 'Enter') {
          const searchTerm = this.value.trim();
          console.log('Search term:', searchTerm);
          // Th·ª±c hi·ªán t√¨m ki·∫øm
          // loadOrders(1, searchTerm);
        }
      });
    }
  });
  
  // H√†m s·∫Øp x·∫øp ƒë∆°n h√†ng
  function sortOrders(sortType) {
    // L·∫•y t·∫•t c·∫£ c√°c h√†ng trong b·∫£ng
    const tbody = document.getElementById('orders-list');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    
    // S·∫Øp x·∫øp d·ª±a tr√™n lo·∫°i s·∫Øp x·∫øp
    switch(sortType) {
      case 'order-asc':
        rows.sort((a, b) => {
          const aValue = a.querySelector('.order-id').textContent;
          const bValue = b.querySelector('.order-id').textContent;
          return aValue.localeCompare(bValue);
        });
        break;
        
      case 'order-desc':
        rows.sort((a, b) => {
          const aValue = a.querySelector('.order-id').textContent;
          const bValue = b.querySelector('.order-id').textContent;
          return bValue.localeCompare(aValue);
        });
        break;
        
      case 'date-asc':
        rows.sort((a, b) => {
          const aValue = new Date(a.querySelectorAll('td')[2].textContent);
          const bValue = new Date(b.querySelectorAll('td')[2].textContent);
          return aValue - bValue;
        });
        break;
        
      case 'date-desc':
        rows.sort((a, b) => {
          const aValue = new Date(a.querySelectorAll('td')[2].textContent);
          const bValue = new Date(b.querySelectorAll('td')[2].textContent);
          return bValue - aValue;
        });
        break;
        
      case 'customer-asc':
        rows.sort((a, b) => {
          const aValue = a.querySelectorAll('td')[3].textContent;
          const bValue = b.querySelectorAll('td')[3].textContent;
          return aValue.localeCompare(bValue);
        });
        break;
        
      case 'customer-desc':
        rows.sort((a, b) => {
          const aValue = a.querySelectorAll('td')[3].textContent;
          const bValue = b.querySelectorAll('td')[3].textContent;
          return bValue.localeCompare(aValue);
        });
        break;
        
      case 'payment-paid':
        // L·ªçc ch·ªâ hi·ªÉn th·ªã ƒë∆°n h√†ng ƒë√£ thanh to√°n
        rows.forEach(row => {
          const paymentStatus = row.querySelectorAll('td')[4].querySelector('.status').textContent;
          row.style.display = paymentStatus.includes('ƒê√£ thanh to√°n') ? '' : 'none';
        });
        return; // Kh√¥ng c·∫ßn s·∫Øp x·∫øp l·∫°i
        
      case 'payment-unpaid':
        // L·ªçc ch·ªâ hi·ªÉn th·ªã ƒë∆°n h√†ng ch∆∞a thanh to√°n
        rows.forEach(row => {
          const paymentStatus = row.querySelectorAll('td')[4].querySelector('.status').textContent;
          row.style.display = !paymentStatus.includes('ƒê√£ thanh to√°n') ? '' : 'none';
        });
        return; // Kh√¥ng c·∫ßn s·∫Øp x·∫øp l·∫°i
        
      case 'payment-all':
        // Hi·ªÉn th·ªã t·∫•t c·∫£ ƒë∆°n h√†ng
        rows.forEach(row => {
          row.style.display = '';
        });
        return; // Kh√¥ng c·∫ßn s·∫Øp x·∫øp l·∫°i
        
      case 'products-asc':
        // S·∫Øp x·∫øp theo s·ªë l∆∞·ª£ng s·∫£n ph·∫©m tƒÉng d·∫ßn
        rows.sort((a, b) => {
          const aText = a.querySelectorAll('td')[5].textContent;
          const bText = b.querySelectorAll('td')[5].textContent;
          const aValue = parseInt(aText.match(/\d+/)[0]);
          const bValue = parseInt(bText.match(/\d+/)[0]);
          return aValue - bValue;
        });
        break;
        
      case 'products-desc':
        // S·∫Øp x·∫øp theo s·ªë l∆∞·ª£ng s·∫£n ph·∫©m gi·∫£m d·∫ßn
        rows.sort((a, b) => {
          const aText = a.querySelectorAll('td')[5].textContent;
          const bText = b.querySelectorAll('td')[5].textContent;
          const aValue = parseInt(aText.match(/\d+/)[0]);
          const bValue = parseInt(bText.match(/\d+/)[0]);
          return bValue - aValue;
        });
        break;
        
      case 'total-asc':
        rows.sort((a, b) => {
          const aValue = parseFloat(a.querySelectorAll('td')[6].textContent.replace(/[^\d]/g, ''));
          const bValue = parseFloat(b.querySelectorAll('td')[6].textContent.replace(/[^\d]/g, ''));
          return aValue - bValue;
        });
        break;
        
      case 'total-desc':
        rows.sort((a, b) => {
          const aValue = parseFloat(a.querySelectorAll('td')[6].textContent.replace(/[^\d]/g, ''));
          const bValue = parseFloat(b.querySelectorAll('td')[6].textContent.replace(/[^\d]/g, ''));
          return bValue - aValue;
        });
        break;
        
      // Th√™m x·ª≠ l√Ω cho c√°c tr∆∞·ªùng h·ª£p shipping status
      case 'shipping-pending':
      case 'shipping-transit':
      case 'shipping-delivered':
      case 'shipping-failed':
      case 'shipping-returned':
        // L·∫•y tr·∫°ng th√°i v·∫≠n chuy·ªÉn c·∫ßn l·ªçc
        const shippingStatusToFilter = sortType.replace('shipping-', '');
        // L·ªçc c√°c ƒë∆°n h√†ng theo tr·∫°ng th√°i v·∫≠n chuy·ªÉn
        rows.forEach(row => {
          const badgeElement = row.querySelectorAll('td')[7].querySelector('.badge');
          const shippingStatus = badgeElement ? badgeElement.className : '';
          
          // Ki·ªÉm tra xem tr·∫°ng th√°i c√≥ kh·ªõp kh√¥ng
          let shouldDisplay = false;
          if (shippingStatusToFilter === 'pending' && shippingStatus.includes('badge-secondary')) {
            shouldDisplay = true;
          } else if (shippingStatusToFilter === 'transit' && shippingStatus.includes('badge-primary')) {
            shouldDisplay = true;
          } else if (shippingStatusToFilter === 'delivered' && shippingStatus.includes('badge-success')) {
            shouldDisplay = true;
          } else if (shippingStatusToFilter === 'failed' && shippingStatus.includes('badge-danger')) {
            shouldDisplay = true;
          } else if (shippingStatusToFilter === 'returned' && shippingStatus.includes('badge-warning')) {
            shouldDisplay = true;
          }
          
          row.style.display = shouldDisplay ? '' : 'none';
        });
        return; // Kh√¥ng c·∫ßn s·∫Øp x·∫øp l·∫°i
        
      case 'shipping-all':
        // Hi·ªÉn th·ªã t·∫•t c·∫£ ƒë∆°n h√†ng
        rows.forEach(row => {
          row.style.display = '';
        });
        return; // Kh√¥ng c·∫ßn s·∫Øp x·∫øp l·∫°i
        
      // Th√™m x·ª≠ l√Ω cho c√°c tr∆∞·ªùng h·ª£p order status
      case 'status-pending':
      case 'status-confirmed':
      case 'status-shipping':
      case 'status-success':
      case 'status-failed':
      case 'status-cancelled':
        // L·∫•y tr·∫°ng th√°i ƒë∆°n h√†ng c·∫ßn l·ªçc
        const statusToFilter = sortType.replace('status-', '').toUpperCase();
        // L·ªçc c√°c ƒë∆°n h√†ng theo tr·∫°ng th√°i
        rows.forEach(row => {
          const selectElement = row.querySelectorAll('td')[8].querySelector('select');
          const currentStatus = selectElement ? selectElement.getAttribute('data-current-status') : '';
          row.style.display = (currentStatus === statusToFilter) ? '' : 'none';
        });
        return; // Kh√¥ng c·∫ßn s·∫Øp x·∫øp l·∫°i
        
      case 'status-all':
        // Hi·ªÉn th·ªã t·∫•t c·∫£ ƒë∆°n h√†ng
        rows.forEach(row => {
          row.style.display = '';
        });
        return; // Kh√¥ng c·∫ßn s·∫Øp x·∫øp l·∫°i
        
      case 'update-asc':
        rows.sort((a, b) => {
          const aValue = new Date(a.querySelectorAll('td')[9].textContent);
          const bValue = new Date(b.querySelectorAll('td')[9].textContent);
          return aValue - bValue;
        });
        break;
        
      case 'update-desc':
        rows.sort((a, b) => {
          const aValue = new Date(a.querySelectorAll('td')[9].textContent);
          const bValue = new Date(b.querySelectorAll('td')[9].textContent);
          return bValue - aValue;
        });
        break;
    }
    
    // X√≥a c√°c h√†ng hi·ªán t·∫°i
    while (tbody.firstChild) {
      tbody.removeChild(tbody.firstChild);
    }
    
    // Th√™m l·∫°i c√°c h√†ng ƒë√£ s·∫Øp x·∫øp
    rows.forEach(row => {
      if (row.style.display !== 'none') {
        tbody.appendChild(row);
      }
    });
    
    // Th√¥ng b√°o ƒë√£ s·∫Øp x·∫øp xong
    if (window.antd && window.antd.message) {
      window.antd.message.success('ƒê√£ s·∫Øp x·∫øp d·ªØ li·ªáu');
    }
  }
</script>
<script>
  async function loadOrders() {
    try {
      const res = await fetch('/api/orders/admin', {
        headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
      });
      const data = await res.json();
      console.log("Orders data:", data);

      if (!data.success) throw new Error(data.message);

      const orders = data.orders;
      const tbody = document.getElementById('orders-list');
      tbody.innerHTML = ''; // Clear c≈©

      orders.forEach(order => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
        <td><input type="checkbox" class="checkbox"></td>
        <td class="order-id">${order.order_hash}</td>
        <td>${formatDate(order.created_at)}</td>
        <td>${order.order_name_new || order.order_name_old || order.user_name}</td>
        <td><span class="status ${mapPaymentStatusClass(order.payment_status)}">${mapPaymentStatus(order.payment_status)}</span></td>
        <td>${order.item_count} s·∫£n ph·∫©m</td>
        <td>${formatPrice(order.order_total_final)} ƒë</td>
        <td>
          <span class="badge ${mapShippingStatusClass(order.shipping_status)}">
            <i class="fas ${mapShippingStatusIcon(order.shipping_status)} mr-1"></i>
            ${mapShippingStatus(order.shipping_status)}
          </span>
        </td>
        <td>
          <select class="order-status-select" data-order-id="${order.order_id}" data-current-status="${order.current_status}" onchange="confirmStatusChange(this)">
            <option value="PENDING" ${order.current_status === 'PENDING' ? 'selected' : ''} ${order.current_status !== 'PENDING' ? 'disabled' : ''}>Ch·ªù x√°c nh·∫≠n</option>
            <option value="CONFIRMED" ${order.current_status === 'CONFIRMED' ? 'selected' : ''} ${(order.current_status !== 'PENDING' && order.current_status !== 'CONFIRMED') ? 'disabled' : ''}>ƒê√£ x√°c nh·∫≠n</option>
            <option value="SHIPPING" ${order.current_status === 'SHIPPING' ? 'selected' : ''} ${(order.current_status !== 'CONFIRMED' && order.current_status !== 'SHIPPING') ? 'disabled' : ''}>ƒêang giao</option>
            <option value="SUCCESS" ${order.current_status === 'SUCCESS' ? 'selected' : ''} ${(order.current_status !== 'SHIPPING' && order.current_status !== 'SUCCESS') ? 'disabled' : ''}>Giao h√†ng th√†nh c√¥ng</option>
            <option value="FAILED" ${order.current_status === 'FAILED' ? 'selected' : ''}>Th·∫•t b·∫°i</option>
            <option value="CANCELLED" ${order.current_status === 'CANCELLED' ? 'selected' : ''}>ƒê√£ h·ªßy</option>
          </select>
        </td>
        <td>${formatDate(order.created_at)}</td>
        <td>
          <div class="actions">
            <a href="/dashboard/orders/detail/${order.order_id}" class="action-btn view-btn" title="Xem chi ti·∫øt"><i class="fas fa-eye"></i></a>
            <button class="action-btn"><i class="fas fa-pencil-alt"></i></button>
            <button class="action-btn"><i class="fas fa-trash-alt"></i></button>
          </div>
        </td>
      `;
        tbody.appendChild(tr);
      });
    } catch (err) {
      console.error("L·ªói khi load orders:", err);
    }
  }

  function formatDate(dateStr) {
    const d = new Date(dateStr);
    return `${d.getHours()}:${d.getMinutes()}:${d.getSeconds()} ${d.getDate()}-${d.getMonth() + 1}-${d.getFullYear()}`;
  }

  function formatPrice(price) {
    const numeric = parseFloat(price);
    const integerPart = Math.floor(numeric);
    return integerPart.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
  }


  function mapStatus(status) {
    switch (status) {
      case 'PENDING': return 'Ch·ªù x√°c nh·∫≠n';
      case 'CONFIRMED': return 'ƒê√£ x√°c nh·∫≠n';
      case 'SHIPPING': return 'ƒêang giao';
      case 'SUCCESS': return 'Giao h√†ng th√†nh c√¥ng';
      case 'FAILED': return 'Th·∫•t b·∫°i';
      case 'CANCELLED': return 'ƒê√£ h·ªßy';
      default: return status;
    }
  }

  function mapPaymentStatus(status) {
    switch (status) {
      case 'PENDING': return 'Ch·ªù thanh to√°n';
      case 'PROCESSING': return 'ƒêang x·ª≠ l√Ω';
      case 'SUCCESS': return 'ƒê√£ thanh to√°n';
      case 'FAILED': return 'Thanh to√°n th·∫•t b·∫°i';
      case 'CANCELLED': return 'ƒê√£ h·ªßy';
      default: return status || 'Ch·ªù thanh to√°n';
    }
  }

  function mapPaymentStatusClass(status) {
    switch (status) {
      case 'PENDING': return 'pending';
      case 'PROCESSING': return 'processing';
      case 'SUCCESS': return 'paid';
      case 'FAILED': return 'failed';
      case 'CANCELLED': return 'cancelled';
      default: return 'pending';
    }
  }

  function mapShippingStatus(status) {
    switch (status) {
      case 'pending': return 'Ch·ªù l·∫•y h√†ng';
      case 'picking_up': return 'ƒêang ƒëi l·∫•y h√†ng';
      case 'picked_up': return 'ƒê√£ l·∫•y h√†ng';
      case 'in_transit': return 'ƒêang v·∫≠n chuy·ªÉn';
      case 'delivered': return 'ƒê√£ giao h√†ng';
      case 'delivery_failed': return 'Giao h√†ng th·∫•t b·∫°i';
      case 'returning': return 'ƒêang ho√†n tr·∫£';
      case 'returned': return 'ƒê√£ ho√†n tr·∫£';
      case 'canceled': return 'ƒê√£ h·ªßy';
      default: return status || 'Ch·ªù l·∫•y h√†ng';
    }
  }

  function mapShippingStatusClass(status) {
    switch (status) {
      case 'pending': return 'badge-secondary';
      case 'picking_up': return 'badge-info';
      case 'picked_up': return 'badge-primary';
      case 'in_transit': return 'badge-primary';
      case 'delivered': return 'badge-success';
      case 'delivery_failed': return 'badge-danger';
      case 'returning': return 'badge-warning';
      case 'returned': return 'badge-warning';
      case 'canceled': return 'badge-dark';
      default: return 'badge-secondary';
    }
  }

  function mapShippingStatusIcon(status) {
    switch (status) {
      case 'pending': return 'fa-clock';
      case 'picking_up': return 'fa-people-carry';
      case 'picked_up': return 'fa-box';
      case 'in_transit': return 'fa-truck';
      case 'delivered': return 'fa-check-circle';
      case 'delivery_failed': return 'fa-times-circle';
      case 'returning': return 'fa-undo';
      case 'returned': return 'fa-box-open';
      case 'canceled': return 'fa-ban';
      default: return 'fa-clock';
    }
  }

  function showStatusDropdown(element) {
    // X√≥a h√†m n√†y v√¨ kh√¥ng c·∫ßn thi·∫øt n·ªØa
  }

  function confirmStatusChange(selectElement) {
    const orderId = selectElement.getAttribute('data-order-id');
    const previousStatus = selectElement.getAttribute('data-current-status');
    const newStatus = selectElement.value;

    // N·∫øu tr·∫°ng th√°i kh√¥ng thay ƒë·ªïi, kh√¥ng l√†m g√¨ c·∫£
    if (previousStatus === newStatus) {
      return;
    }

    // ƒê·ªãnh nghƒ©a th·ª© t·ª± c√°c tr·∫°ng th√°i
    const statusOrder = {
      'PENDING': 1,
      'CONFIRMED': 2,
      'SHIPPING': 3,
      'SUCCESS': 4,
      'FAILED': 5,
      'CANCELLED': 6
    };

    // Ki·ªÉm tra xem c√≥ ƒëang c·ªë g·∫Øng l√πi step kh√¥ng
    // Cho ph√©p chuy·ªÉn sang FAILED ho·∫∑c CANCELLED t·ª´ b·∫•t k·ª≥ tr·∫°ng th√°i n√†o
    if (newStatus !== 'FAILED' && newStatus !== 'CANCELLED' && 
        statusOrder[newStatus] < statusOrder[previousStatus]) {
      // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói
      if (window.antd && window.antd.notification) {
        window.antd.notification.error({
          message: 'Kh√¥ng ƒë∆∞·ª£c ph√©p',
          description: 'Kh√¥ng th·ªÉ l√πi tr·∫°ng th√°i ƒë∆°n h√†ng v·ªÅ b∆∞·ªõc tr∆∞·ªõc ƒë√≥',
          placement: 'topRight'
        });
      } else {
        alert('Kh√¥ng th·ªÉ l√πi tr·∫°ng th√°i ƒë∆°n h√†ng v·ªÅ b∆∞·ªõc tr∆∞·ªõc ƒë√≥');
      }
      
      // Kh√¥i ph·ª•c gi√° tr·ªã c≈©
      selectElement.value = previousStatus;
      return;
    }

    // L·∫•y t√™n tr·∫°ng th√°i ƒë·ªÉ hi·ªÉn th·ªã
    const previousStatusText = mapStatus(previousStatus);
    const newStatusText = mapStatus(newStatus);

    // S·ª≠ d·ª•ng Ant Design Modal ƒë·ªÉ x√°c nh·∫≠n
    if (window.antd && window.antd.Modal) {
      window.antd.Modal.confirm({
        title: 'X√°c nh·∫≠n thay ƒë·ªïi tr·∫°ng th√°i',
        content: `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën thay ƒë·ªïi tr·∫°ng th√°i ƒë∆°n h√†ng t·ª´ "${previousStatusText}" sang "${newStatusText}"?`,
        okText: 'X√°c nh·∫≠n',
        cancelText: 'H·ªßy',
        onOk: () => updateOrderStatus(orderId, newStatus),
        onCancel: () => {
          // Kh√¥i ph·ª•c gi√° tr·ªã c≈©
          selectElement.value = previousStatus;
        }
      });
    } else {
      // Fallback n·∫øu kh√¥ng c√≥ Ant Design
      if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën thay ƒë·ªïi tr·∫°ng th√°i ƒë∆°n h√†ng t·ª´ "${previousStatusText}" sang "${newStatusText}"?`)) {
        updateOrderStatus(orderId, newStatus);
      } else {
        // Kh√¥i ph·ª•c gi√° tr·ªã c≈©
        selectElement.value = previousStatus;
      }
    }
  }

  async function updateOrderStatus(orderId, newStatus) {
    try {
      const response = await fetch(`/api/orders/${orderId}/status`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + localStorage.getItem('token')
        },
        body: JSON.stringify({ new_status: newStatus })
      });

      const data = await response.json();

      if (data.success) {
        // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng s·ª≠ d·ª•ng Ant Design
        if (window.antd && window.antd.notification) {
          window.antd.notification.success({
            message: 'Th√†nh c√¥ng',
            description: data.message,
            placement: 'topRight'
          });
        } else {
          // Fallback n·∫øu kh√¥ng c√≥ Ant Design
          alert(data.message);
        }

        // C·∫≠p nh·∫≠t l·∫°i danh s√°ch ƒë∆°n h√†ng
        loadOrders();
      } else {
        // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói
        if (window.antd && window.antd.notification) {
          window.antd.notification.error({
            message: 'L·ªói',
            description: data.message,
            placement: 'topRight'
          });
        } else {
          alert('L·ªói: ' + data.message);
        }

        // C·∫≠p nh·∫≠t l·∫°i danh s√°ch ƒë∆°n h√†ng ƒë·ªÉ ƒë·∫£m b·∫£o hi·ªÉn th·ªã tr·∫°ng th√°i ch√≠nh x√°c
        loadOrders();
      }
    } catch (error) {
      console.error('L·ªói khi c·∫≠p nh·∫≠t tr·∫°ng th√°i:', error);

      if (window.antd && window.antd.notification) {
        window.antd.notification.error({
          message: 'L·ªói',
          description: 'ƒê√£ x·∫£y ra l·ªói khi c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng',
          placement: 'topRight'
        });
      } else {
        alert('ƒê√£ x·∫£y ra l·ªói khi c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng');
      }

      // C·∫≠p nh·∫≠t l·∫°i danh s√°ch ƒë∆°n h√†ng ƒë·ªÉ ƒë·∫£m b·∫£o hi·ªÉn th·ªã tr·∫°ng th√°i ch√≠nh x√°c
      loadOrders();
    }
  }

  document.addEventListener('DOMContentLoaded', function () {
    loadOrders(); // üöÄ Load ƒë∆°n h√†ng khi v√†o trang

    // X√≥a x·ª≠ l√Ω s·ª± ki·ªán c·∫≠p nh·∫≠t tr·∫°ng th√°i c≈©

    // X·ª≠ l√Ω s·ª± ki·ªán ƒë√≥ng modal
    const closeButtons = document.querySelectorAll('[data-dismiss="modal"]');
    closeButtons.forEach(button => {
      button.addEventListener('click', function () {
        const modalId = this.closest('.modal').id;

        if (typeof $ !== 'undefined') {
          $(`#${modalId}`).modal('hide');
        } else {
          const modal = document.getElementById(modalId);
          modal.classList.remove('show');
          modal.style.display = 'none';
          modal.setAttribute('aria-hidden', 'true');
          document.body.classList.remove('modal-open');

          // X√≥a backdrop
          const backdrop = document.querySelector('.modal-backdrop');
          if (backdrop) {
            backdrop.parentNode.removeChild(backdrop);
          }
        }
      });
    });

    // Kh·ªüi t·∫°o Ant Design n·∫øu c·∫ßn
    if (window.antd) {
      console.log('Ant Design loaded successfully');

      // C√≥ th·ªÉ th√™m c√°c c·∫•u h√¨nh kh√°c cho Ant Design ·ªü ƒë√¢y
      if (window.antd.message) {
        window.antd.message.config({
          top: 60,
          duration: 2,
          maxCount: 3,
        });
      }
    }

    // C·∫≠p nh·∫≠t m√†u s·∫Øc c·ªßa select khi thay ƒë·ªïi gi√° tr·ªã
    document.addEventListener('change', function (e) {
      if (e.target && e.target.classList.contains('order-status-select')) {
        // C·∫≠p nh·∫≠t data-current-status ƒë·ªÉ CSS c√≥ th·ªÉ √°p d·ª•ng m√†u s·∫Øc m·ªõi
        e.target.setAttribute('data-current-status', e.target.value);
      }
    });
  });
</script>