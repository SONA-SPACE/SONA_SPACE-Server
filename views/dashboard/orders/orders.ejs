<link rel="stylesheet" href="/scss/style.css">
<!-- Trang qu·∫£n l√Ω ƒë∆°n h√†ng -->
<div class="orders-page">
  <div class="content-wrapper">
    <div class="content-header">
      <div class="container-fluid">
        <div class="page-header">
          <h1>ƒê∆°n h√†ng</h1>
          <div class="actions">
            <button class="btn btn-primary">
              <i class="fas fa-plus"></i> Th√™m ƒë∆°n h√†ng m·ªõi
            </button>
          </div>
        </div>
        
        <div class="search-bar">
          <div class="search-input">
            <i class="fas fa-search search-icon"></i>
            <input type="text" placeholder="T√¨m ki·∫øm ƒë∆°n h√†ng..." id="search-orders">
          </div>
          
          <div class="date-range">
            <i class="far fa-calendar-alt calendar-icon"></i>
            <span>1/05/2025 - 31/5/2025</span>
          </div>
          
          <div class="filter-btn">
            <span>Hi·ªÉn th·ªã 6 tr√™n t·ªïng s·ªë 500</span>
          </div>
        </div>
        
        <div class="orders-summary">
          <div class="summary-card">
            <div class="card-title">T·ªïng ƒë∆°n h√†ng</div>
            <div class="card-value">20</div>
          </div>
          
          <div class="summary-card">
            <div class="card-title">ƒê∆°n h√†ng</div>
            <div class="card-subtitle">ƒê∆°n h√†ng ƒëang ch·ªù x·ª≠ l√Ω</div>
            <div class="card-value">20</div>
          </div>
          
          <div class="summary-card">
            <div class="card-title">ƒêang v·∫≠n chuy·ªÉn</div>
            <div class="card-subtitle">T·ªïng ƒë∆°n h√†ng ƒëang v·∫≠n chuy·ªÉn</div>
            <div class="card-value">2</div>
          </div>
          
          <div class="summary-card">
            <div class="card-title">Ho√†n tr·∫£ ƒë∆°n h√†ng</div>
            <div class="card-subtitle">ƒê∆°n h√†ng ƒë∆∞·ª£c y√™u c·∫ßu tr·∫£ h√†ng</div>
            <div class="card-value">0</div>
          </div>
          
          <div class="summary-card">
            <div class="card-title">H·ªßy ƒë∆°n h√†ng</div>
            <div class="card-subtitle">ƒê∆°n h√†ng ƒë∆∞·ª£c y√™u c·∫ßu h·ªßy</div>
            <div class="card-value">0</div>
          </div>
        </div>
        
        <div class="orders-table">
          <div class="table-header">
            <div class="bulk-actions">
              <input type="checkbox" class="checkbox">
              <div class="dropdown">
                <button class="dropdown-toggle">M√£ ƒë∆°n <i class="fas fa-chevron-down"></i></button>
              </div>
            </div>
            
            <div class="table-filters">
              <div class="filter">
                <button class="filter-toggle">Ng√†y ƒë·∫∑t ƒë∆°n</button>
              </div>
              <div class="filter">
                <button class="filter-toggle">Kh√°ch h√†ng</button>
              </div>
              <div class="filter">
                <button class="filter-toggle">Thanh to√°n</button>
              </div>
              <div class="filter">
                <button class="filter-toggle">S·∫£n ph·∫©m</button>
              </div>
              <div class="filter">
                <button class="filter-toggle">T·ªïng ti·ªÅn</button>
              </div>
              <div class="filter">
                <button class="filter-toggle">V·∫≠n chuy·ªÉn</button>
              </div>
              <div class="filter">
                <button class="filter-toggle">Tr·∫°ng th√°i</button>
              </div>
              <div class="filter">
                <button class="filter-toggle">Ng√†y c·∫≠p nh·∫≠t</button>
              </div>
              <div class="filter">
                <button class="filter-toggle">H√†nh ƒë·ªông</button>
              </div>
            </div>
          </div>
          
          <table>
            <tbody id="orders-list">
              <!-- D·ªØ li·ªáu ƒë∆°n h√†ng m·∫´u -->
              <!-- <tr>
                <td><input type="checkbox" class="checkbox"></td>
                <td class="order-id">ORD-10586</td>
                <td>16:08:55 8-05-2025</td>
                <td>Nguy·ªÖn X</td>
                <td><span class="status paid">ƒê√£ thanh to√°n</span></td>
                <td>2 s·∫£n ph·∫©m</td>
                <td>15.050.000 ƒë</td>
                <td>-</td>
                <td><span class="status processing">Y√™u c·∫ßu h·ªßy</span></td>
                <td>16:08:55 8-05-2025</td>
                <td>
                  <div class="actions">
                    <button class="action-btn"><i class="fas fa-pencil-alt"></i></button>
                    <button class="action-btn"><i class="fas fa-trash-alt"></i></button>
                  </div>
                </td>
              </tr>
              
              <tr>
                <td><input type="checkbox" class="checkbox"></td>
                <td class="order-id">ORD-10586</td>
                <td>16:08:55 8-05-2025</td>
                <td>Nguy·ªÖn X</td>
                <td><span class="status paid">ƒê√£ thanh to√°n</span></td>
                <td>2 s·∫£n ph·∫©m</td>
                <td>15.050.000 ƒë</td>
                <td>-</td>
                <td><span class="status processing">Ch·ªù x√°c nh·∫≠n</span></td>
                <td>16:08:55 8-05-2025</td>
                <td>
                  <div class="actions">
                    <button class="action-btn"><i class="fas fa-pencil-alt"></i></button>
                    <button class="action-btn"><i class="fas fa-trash-alt"></i></button>
                  </div>
                </td>
              </tr>
              
              <tr>
                <td><input type="checkbox" class="checkbox"></td>
                <td class="order-id">ORD-10586</td>
                <td>16:08:55 8-05-2025</td>
                <td>Nguy·ªÖn X</td>
                <td><span class="status paid">ƒê√£ thanh to√°n</span></td>
                <td>2 s·∫£n ph·∫©m</td>
                <td>15.050.000 ƒë</td>
                <td>-</td>
                <td><span class="status processing">Y√™u c·∫ßu h·ªßy</span></td>
                <td>16:08:55 8-05-2025</td>
                <td>
                  <div class="actions">
                    <button class="action-btn"><i class="fas fa-pencil-alt"></i></button>
                    <button class="action-btn"><i class="fas fa-trash-alt"></i></button>
                  </div>
                </td>
              </tr>
              
              <tr>
                <td><input type="checkbox" class="checkbox"></td>
                <td class="order-id">ORD-10586</td>
                <td>16:08:55 8-05-2025</td>
                <td>Nguy·ªÖn X</td>
                <td><span class="status paid">ƒê√£ thanh to√°n</span></td>
                <td>2 s·∫£n ph·∫©m</td>
                <td>15.050.000 ƒë</td>
                <td>-</td>
                <td><span class="status delivered">ƒê√£ h·ªßy</span></td>
                <td>16:08:55 8-05-2025</td>
                <td>
                  <div class="actions">
                    <button class="action-btn"><i class="fas fa-pencil-alt"></i></button>
                    <button class="action-btn"><i class="fas fa-trash-alt"></i></button>
                  </div>
                </td>
              </tr>
              
              <tr>
                <td><input type="checkbox" class="checkbox"></td>
                <td class="order-id">ORD-10586</td>
                <td>16:08:55 8-05-2025</td>
                <td>Nguy·ªÖn X</td>
                <td><span class="status paid">ƒê√£ thanh to√°n</span></td>
                <td>2 s·∫£n ph·∫©m</td>
                <td>15.050.000 ƒë</td>
                <td>-</td>
                <td><span class="status shipped">ƒêang giao</span></td>
                <td>16:08:55 8-05-2025</td>
                <td>
                  <div class="actions">
                    <button class="action-btn"><i class="fas fa-pencil-alt"></i></button>
                    <button class="action-btn"><i class="fas fa-trash-alt"></i></button>
                  </div>
                </td>
              </tr>
              
              <tr>
                <td><input type="checkbox" class="checkbox"></td>
                <td class="order-id">ORD-10586</td>
                <td>16:08:55 8-05-2025</td>
                <td>Nguy·ªÖn X</td>
                <td><span class="status paid">ƒê√£ thanh to√°n</span></td>
                <td>2 s·∫£n ph·∫©m</td>
                <td>15.050.000 ƒë</td>
                <td>-</td>
                <td><span class="status processing">Y√™u c·∫ßu tr·∫£ h√†ng</span></td>
                <td>16:08:55 8-05-2025</td>
                <td>
                  <div class="actions">
                    <button class="action-btn"><i class="fas fa-pencil-alt"></i></button>
                    <button class="action-btn"><i class="fas fa-trash-alt"></i></button>
                  </div>
                </td>
              </tr>
              
              <tr>
                <td><input type="checkbox" class="checkbox"></td>
                <td class="order-id">ORD-10586</td>
                <td>16:08:55 8-05-2025</td>
                <td>Nguy·ªÖn X</td>
                <td><span class="status paid">ƒê√£ thanh to√°n</span></td>
                <td>2 s·∫£n ph·∫©m</td>
                <td>15.050.000 ƒë</td>
                <td>-</td>
                <td><span class="status delivered">Tr·∫£ h√†ng</span></td>
                <td>16:08:55 8-05-2025</td>
                <td>
                  <div class="actions">
                    <button class="action-btn"><i class="fas fa-pencil-alt"></i></button>
                    <button class="action-btn"><i class="fas fa-trash-alt"></i></button>
                  </div>
                </td>
              </tr>
              
              <tr>
                <td><input type="checkbox" class="checkbox"></td>
                <td class="order-id">ORD-10586</td>
                <td>16:08:55 8-05-2025</td>
                <td>Nguy·ªÖn X</td>
                <td><span class="status paid">ƒê√£ thanh to√°n</span></td>
                <td>2 s·∫£n ph·∫©m</td>
                <td>15.050.000 ƒë</td>
                <td>-</td>
                <td><span class="status delivered">Giao h√†ng th√†nh c√¥ng</span></td>
                <td>16:08:55 8-05-2025</td>
                <td>
                  <div class="actions">
                    <button class="action-btn"><i class="fas fa-pencil-alt"></i></button>
                    <button class="action-btn"><i class="fas fa-trash-alt"></i></button>
                  </div>
                </td>
              </tr> -->
            </tbody>
          </table>
          
          <div class="table-footer">
            <div class="showing-info">Hi·ªÉn th·ªã 1-8 tr√™n t·ªïng s·ªë 20 ƒë∆°n h√†ng</div>
            <div class="pagination">
              <button class="page-item disabled"><i class="fas fa-chevron-left"></i></button>
              <button class="page-item active">1</button>
              <button class="page-item">2</button>
              <button class="page-item">3</button>
              <button class="page-item"><i class="fas fa-chevron-right"></i></button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal xem chi ti·∫øt ƒë∆°n h√†ng -->
<div class="modal fade" id="order-detail-modal" tabindex="-1" role="dialog" aria-labelledby="orderDetailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="orderDetailModalLabel">Chi ti·∫øt ƒë∆°n h√†ng #<span id="order-id"></span></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="order-detail-content">
        <!-- Chi ti·∫øt ƒë∆°n h√†ng s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y b·∫±ng JavaScript -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">ƒê√≥ng</button>
        <button type="button" class="btn btn-primary" id="update-status-btn">C·∫≠p nh·∫≠t tr·∫°ng th√°i</button>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // X·ª≠ l√Ω s·ª± ki·ªán ch·ªçn t·∫•t c·∫£ checkbox
  const selectAllCheckbox = document.querySelector('.table-header .checkbox');
  const rowCheckboxes = document.querySelectorAll('tbody .checkbox');
  
  if (selectAllCheckbox) {
    selectAllCheckbox.addEventListener('change', function() {
      const isChecked = this.checked;
      rowCheckboxes.forEach(checkbox => {
        checkbox.checked = isChecked;
      });
    });
  }
  
  // X·ª≠ l√Ω s·ª± ki·ªán khi click v√†o dropdown filters
  const filterToggles = document.querySelectorAll('.filter-toggle');
  
  filterToggles.forEach(toggle => {
    toggle.addEventListener('click', function() {
      // ƒê√¢y l√† n∆°i ƒë·ªÉ th√™m logic hi·ªÉn th·ªã dropdown filter
      console.log('Filter clicked:', this.textContent.trim());
    });
  });
  
  // X·ª≠ l√Ω s·ª± ki·ªán khi click v√†o n√∫t ch·ªânh s·ª≠a
  const editButtons = document.querySelectorAll('.action-btn.edit');
  
  editButtons.forEach(button => {
    button.addEventListener('click', function() {
      const row = this.closest('tr');
      const orderId = row.querySelector('.order-id').textContent;
      console.log('Edit order:', orderId);
      // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang ch·ªânh s·ª≠a ƒë∆°n h√†ng
      // window.location.href = `/dashboard/orders/edit/${orderId}`;
    });
  });
  
  // X·ª≠ l√Ω s·ª± ki·ªán khi click v√†o n√∫t x√≥a
  const deleteButtons = document.querySelectorAll('.action-btn.delete');
  
  deleteButtons.forEach(button => {
    button.addEventListener('click', function() {
      const row = this.closest('tr');
      const orderId = row.querySelector('.order-id').textContent;
      
      if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ƒë∆°n h√†ng ${orderId}?`)) {
        console.log('Delete order:', orderId);
        // G·ªçi API x√≥a ƒë∆°n h√†ng
        // fetch(`/api/orders/${orderId}`, { method: 'DELETE' })
        //   .then(response => response.json())
        //   .then(data => {
        //     if (data.success) {
        //       row.remove();
        //     }
        //   });
      }
    });
  });
  
  // X·ª≠ l√Ω s·ª± ki·ªán t√¨m ki·∫øm
  const searchInput = document.getElementById('search-orders');
  
  if (searchInput) {
    searchInput.addEventListener('keyup', function(e) {
      if (e.key === 'Enter') {
        const searchTerm = this.value.trim();
        console.log('Search term:', searchTerm);
        // Th·ª±c hi·ªán t√¨m ki·∫øm
        // loadOrders(1, searchTerm);
      }
    });
  }
});
</script> 
<script>
async function loadOrders() {
  try {
    const res = await fetch('/api/orders/admin', {
      headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
    });
    const data = await res.json();
    console.log("Orders data:", data);

    if (!data.success) throw new Error(data.message);

    const orders = data.orders;
    const tbody = document.getElementById('orders-list');
    tbody.innerHTML = ''; // Clear c≈©

    orders.forEach(order => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="checkbox" class="checkbox"></td>
        <td class="order-id">${order.order_hash}</td>
        <td>${formatDate(order.created_at)}</td>
        <td>${order.order_name_new || order.order_name_old || order.user_name}</td>
        <td><span class="status paid">ƒê√£ thanh to√°n</span></td>
        <td>${order.item_count} s·∫£n ph·∫©m</td>
        <td>${formatPrice(order.order_total_final)} ƒë</td>
        <td>
          ${(() => {
            // T·∫°o m·∫£ng c√°c tr·∫°ng th√°i v·∫≠n chuy·ªÉn v·ªõi bi·ªÉu t∆∞·ª£ng
            const shippingStatuses = [
              { status: 'ƒêang giao h√†ng', class: 'badge-primary', icon: 'fa-truck' },
              { status: 'ƒêang l·∫•y h√†ng', class: 'badge-warning', icon: 'fa-box' },
              { status: 'Giao h√†ng th√†nh c√¥ng', class: 'badge-success', icon: 'fa-check-circle' },
              { status: 'Giao h√†ng th·∫•t b·∫°i', class: 'badge-danger', icon: 'fa-times-circle' }
            ];
            
            // L·∫•y tr·∫°ng th√°i d·ª±a tr√™n index c·ªßa ƒë∆°n h√†ng
            const statusIndex = order.order_id % 4;
            const currentStatus = shippingStatuses[statusIndex];
            
            return `<span class="badge ${currentStatus.class}"><i class="fas ${currentStatus.icon} mr-1"></i>${currentStatus.status}</span>`;
          })()}
        </td>
        <td><span class="status processing">${mapStatus(order.current_status)}</span></td>
        <td>${formatDate(order.created_at)}</td>
        <td>
          <div class="actions">
            <button class="action-btn"><i class="fas fa-pencil-alt"></i></button>
            <button class="action-btn"><i class="fas fa-trash-alt"></i></button>
          </div>
        </td>
      `;
      tbody.appendChild(tr);
    });
  } catch (err) {
    console.error("L·ªói khi load orders:", err);
  }
}

function formatDate(dateStr) {
  const d = new Date(dateStr);
  return `${d.getHours()}:${d.getMinutes()}:${d.getSeconds()} ${d.getDate()}-${d.getMonth() + 1}-${d.getFullYear()}`;
}

function formatPrice(price) {
  const numeric = parseFloat(price);
  const integerPart = Math.floor(numeric);
  return integerPart.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}


function mapStatus(status) {
  switch (status) {
    case 'PENDING': return 'Ch·ªù x√°c nh·∫≠n';
    case 'CONFIRMED': return 'ƒê√£ x√°c nh·∫≠n';
    case 'SHIPPING': return 'ƒêang giao';
    case 'SUCCESS': return 'Giao h√†ng th√†nh c√¥ng';
    case 'FAILED': return 'Th·∫•t b·∫°i';
    case 'CANCELLED': return 'ƒê√£ h·ªßy';
    default: return status;
  }
}

document.addEventListener('DOMContentLoaded', function () {
  loadOrders(); // üöÄ Load ƒë∆°n h√†ng khi v√†o trang
});
</script>
