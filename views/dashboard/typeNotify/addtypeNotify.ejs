<div class="dashboard-header-row">
    <h2 class="dashboard-title">Sửa loại thông báo</h2>
</div>

<div class="edit-notification-container">
    <div class="form-section">

        <div class="form-group">
          <label for="type_code">Mã loại thông báo</label>
          <input type="text" id="type_code" class="form-control" placeholder="Nhập mã loại ví dụ: 'coupon', 'order'..." />
        </div>
        <div class="form-group">
          <label for="description">Mô tả</label>
          <input type="text" id="description" class="form-control" placeholder="Nhập mô tả thông báo" />
        </div>
        <div class="form-group">
          <label for="is_active">Trạng thái</label>
          <div class="select-wrapper">
            <select id="is_active" class="form-control">
              <option value="1">Hiển thị</option>
              <option value="0">Ẩn</option>
            </select>
            <i class="fas fa-chevron-down"></i>
          </div>
      </div>
       </div>
    </div>

    <div class="form-actions">
      <button type="button" class="btn btn-cancel" onclick="window.location.href='/dashboard/notifications/type-list'">Hủy</button>
      <button type="button" class="btn btn-save">Lưu</button>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelector(".btn-save").addEventListener("click", handleSaveTypeNotify);
  });
document.querySelector(".btn-cancel").addEventListener("click", () => {
    window.history.back();
});

  async function handleSaveTypeNotify() {
    const type_code = document.getElementById("type_code").value.trim();
    const description = document.getElementById("description").value.trim();
    const is_active = parseInt(document.getElementById("is_active").value);

    const saveBtn = document.querySelector(".btn-save");
    saveBtn.disabled = true;
    saveBtn.innerText = "Đang lưu...";

    if (!type_code || !description) {
      showToast("Vui lòng nhập đầy đủ thông tin", "danger");
      saveBtn.disabled = false;
      saveBtn.innerText = "Lưu";
      return;
    }

    const payload = {
      type_code,
      description,
      is_active,
    };

    try {
      const res = await fetch("/api/typeNotify", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${localStorage.getItem("token")}`,
        },
        body: JSON.stringify(payload),
      });

      const data = await res.json();
      if (data.error) {
        showToast(data.error, "danger");
      } else {
        showToast("Thêm kiểu thông báo thành công", "success");
        setTimeout(() => {
          window.location.href = "/dashboard/typeNotify";
        }, 1500);
      }
    } catch (err) {
      showToast("Lỗi máy chủ", "danger");
    } finally {
      saveBtn.disabled = false;
      saveBtn.innerText = "Lưu";
    }
  }

  function showToast(message, type = "success") {
    let toastContainer = document.getElementById("toastContainer");
    if (!toastContainer) {
      toastContainer = document.createElement("div");
      toastContainer.id = "toastContainer";
      toastContainer.className = "position-fixed top-0 end-0 p-3";
      toastContainer.style.zIndex = "1050";
      document.body.appendChild(toastContainer);
    }

    const toast = document.createElement("div");
    toast.className = `toast align-items-center text-white bg-${type} border-0`;
    toast.setAttribute("role", "alert");
    toast.setAttribute("aria-live", "assertive");
    toast.setAttribute("aria-atomic", "true");

    toast.innerHTML = `
      <div class="d-flex">
        <div class="toast-body">${message}</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    `;

    toastContainer.appendChild(toast);
    const bsToast = new bootstrap.Toast(toast, { delay: 4000 });
    bsToast.show();

    toast.addEventListener("hidden.bs.toast", () => toast.remove());
  }
</script>
